**SOCKET(2)             BSD系统调用手册     SOCKET(2)**



#### **名称**

   **socket --   为通信创建一个端点**



#### **概要**

 **`#include <sys/socket.h>`**

**`int`**

**`socket(int domain,int type,int protocol);`**

#### **描述**

  **socket()为通信创建了一个端点并返回一个描述符。参数domain指定了一个通信域——在该通信域内进行通信；它还选择了应该使用的协议族。这些协议族被定义在包含文件<sys/socket.h>中。当前常用的格式有：**

**PF_LOCAL    主机内部的协议，以前被叫做PF_UNIX,**

**PF_UNIX    主机内部的协议，已被废弃，使用PF_LOCAL,**

**PF_INET    因特网第4版协议，**

**PF_ROUTE 因特网路由协议，**

**PF_KEY  因特网密钥管理功能，**

**PF_INET6 因特网第6版协议，**

**PF_SYSTEM  系统域，**

**PF_NDRV   对网络设备的原始访问**

**套接字有指定的类型，这些类型用于指定通信的语义。当前定义的类型是:**

​      **SOCK_STREAM**

​      **SOCK_DGRAM**

​      **SOCK_RAW**

​       **SOCK_STREAM类型提供了序列化的、可靠的、基于双向连接的字节流。可以支持带外数据（out-of-band data transmission）传输机制。SOCK_DGRAM套接字支持数据报(无连接的、具有固定最大长度（通常较小）的不可靠信息)。SOCK_RAW套接字提供对内部网络协议和接口的访问。只有超级用户才可以使用SOCK_RAW类型。**

​      **参数protocol指定了用于套接字的特定协议。通常只有单个协议存在，以支持给定协议族内的某个特定的套接字类型。但是，也有可能存在许多协议，在这种情形下必须用参数protocol来指定某一特定协议。使用的协议号特定于将要发生通信的通信域；请参阅protocols(5)文档。**

​    **SOCK_STREAM类型的套接字是全双工字节流，它类似于管道。在发送或接收任何数据之前，流套接字必须处于连接状态。通过调用connect(2) 或 connectx(2) 来创建对另一个套接字的连接。一旦建立连接，便可用以下方法传输数据:调用read(2)和write(2)或send(2)和recv(2)调用的某些变体。当已经完成了一个会话，可能会执行一次close(2)。带外数据也可能以文档send(2)所描述的方式传输，并以文档recv(2)所描述的方式接收。**

**用于实现SOCK_STREAM的通信协议确保数据既无丢失也无重复。若同级协议具有缓冲空间的数据不能在合理的时间内成功传输，然后连接就会被视为断开，函数调用将返回-1来表明错误，并把ETIMEDOUT作为特定的错误代码赋给全局变量errno。在没有其他活动的情形下，该协议可以选择通过强制传输（大概每分钟一次）来保持套接字处于"热"状态。另外，若在一个延长的时间段内(如5分钟)，未能从一个闲置连接上获得响应，则会指示错误。若某个进程在断开的流上发送，则会引发SIGPIPE信号——这将导致不处理该信号的幼稚进程退出。**

**SOCK_DGRAM和SOCK_RAW套接字允许向在send(2)调用中指定的通信者发送数据报。通常用recvfrom(2)接收数据报，recvfrom(2)会返回它的返回地址和下一个数据报。**

**可以使用 fcntl(2)来指定一个进程组，以便在带外数据抵达时接收SIGURG信号。它还可以通过SIGIO启用非阻塞I/O和I/O事件的异步通知。**

**套接字操作由套接字级别选项来控制——这些选项定义在文件<sys/socket.h>中。Setsockopt(2)和getsockopt(2)分别用于设置和获取选项。**

#### **返回值**

**若发生错误，则返回-1，否则返回值是一个引用套接字的描述符。**

#### **错误**

​       **在以下情形下，socket()系统调用会失败:**

  		**[EACCES]  没有权限创建特定类型（协议）的套接字。**

​          **[EAFNOSUPPORT]   不支持特定的地址族。**

​          **[EMFILE]      每进程描述符表已满。**

​          **[ENFILE]     系统文件表已满。**

​          **[ENOBUFS]   可用的缓冲区空间不足，只有当释放了足够的资源后，才可创建套接字。**

​		   **[ENOMEM]      内存不足，无法满足请求。**

​		  **[EPROTONOSUPPORT] 在该域内不支持协议类型或指定的协议。**

   	   **[EPROTOTYPE]   该协议不支持此套接字类型。**

**若定义了一个新的协议族，则socreate进程可以随意返回任何所需的错误码。socket()系统调用将传递这一错误码(即便它未定义)。**

#### 遗留概要

`#include` 

`#include` 

**包含文件 <sys/types.h> 是必需要有的。**

#### 另请参阅

**accept(2), bind(2), connect(2), connectx(2), disconnectx(2),**

**getsockname(2), getsockopt(2), ioctl(2), listen(2), read(2), recv(2),**

**select(2), send(2), shutdown(2), socketpair(2), write(2), getprotoent(3),**

**inet(4), inet6(4), unix(4), compat(5)**



**4.3BSD进程间通信教程（入门级），在《UNIX程序员补充文档卷1》中重印。**

**BSD进程间通信教程（入门级），在《UNIX程序员补充文档卷1》中重印。**

####  **历史**

   **socket() 函数调用出现在 4.2BSD里.**



**BSD              2015年3月18日            BSD**